<html>
  <head>
    <title>GGP.org - View</title>
    <meta name="description" content="General game playing is about playing games that you've never seen before. Watch intelligent computers play games against each other here!" />  
    <link rel="shortcut icon" href="http://www.ggp.org/favicon.ico">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:bold">
    <link rel="stylesheet" type="text/css" href="/viewer/bellerophon.css" />
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/Analytics.js'></script>
  </head>
  <body>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/UserInterface.js'></script>
    <script type="text/javascript" src="/viewer/bellerophonHeader.js"></script>

    <div id='header'></div>
    <br>
    <div class="major_left">
    
  <center>
  <table width=600px border=1px cellpadding=5px>
    <tr>
      <td class="imageHolder" border=1 width=50 height=50>
        <img width=50 height=50 src="http://placekitten.com/50/50"></img>
      </td>
      <td width=300>
        <font size=5> <b><div id="game_gameName"></div></b> </font>
      </td>
      <td>
        <table width=100%>
          <tr>
            <td><div id="game_gameVersion"></div></td>
          </tr>
          <tr>
            <td><div id="game_gameNumRoles"></div></td>
          </tr>
        </table>
      </td>    
    </tr>
    <tr>
      <td colspan=3>
        <div id="game_gameDescription"></div>
      </td>
    </tr>
    <tr>
      <td colspan=3>
        <table style="width:100%,height:100%">
          <tr id="difficulty_tr">
            <th>Agon Difficulty</th>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan=3>
        <table style="width:100%,height:100%">
          <tr id="correlation_tr">
            <th>Score/Skill Correlation</th>
          </tr>
        </table>
      </td>
    </tr>    
    <tr>
      <td colspan=3>
        <div id="gameStatsDiv"></div>
      </td>
    </tr>
  </table>
  </center>
  <br>

    </div>
    <div class="major_spacer"></div>
    <div class="major_right">    
      <div id='gameMatchesDiv'></div>
    </div>

    <script type='text/javascript'>
      generateHeader(document.getElementById('header'));      

      var toProperString = function (x) {
        if (x <= 0) return "Zero";
        if (x == 1) return "One";
        if (x == 2) return "Two";
        if (x == 3) return "Three";
        if (x == 4) return "Four";
        if (x == 5) return "Five";
        if (x == 6) return "Six";
        if (x == 7) return "Seven";
        if (x == 8) return "Eight";
        if (x == 9) return "Nine";
        return "10+";
      }

      var gameName = translateRepositoryCodename(window.location.pathname.split("/").slice(4).join('/'));      
      var gameRawName = window.location.pathname.split("/")[5];
      
      var statsJSON = ResourceLoader.load_json('//database.ggp.org/statistics/' + getHostHashedPK() + '/games/' + gameName);
      if ("agonScaledDifficulty" in statsJSON && statsJSON.agonScaledDifficulty) {
        var difficultyHTML = "";
        for (var i = 0; i < statsJSON.agonScaledDifficulty.length; i++) {
          difficultyHTML += "<td width=10px></td>";
          difficultyHTML += "<td>" + generateAgonView(1-statsJSON.agonScaledDifficulty[i], statsJSON.agonDifficulty[i], "for Player " + toProperString(i+1) + ": ") + "</td>";
        }
        document.getElementById('difficulty_tr').innerHTML += difficultyHTML;
      }
      delete statsJSON.agonScaledDifficulty;
      delete statsJSON.agonDifficulty;
      if ("roleCorrelationWithSkill" in statsJSON && statsJSON.roleCorrelationWithSkill) {
        var correlationHTML = "";
        for (var i = 0; i < statsJSON.roleCorrelationWithSkill.length; i++) {
          correlationHTML += "<td width=10px></td>";
          correlationHTML += "<td>" + generateAgonView(2*Math.abs(statsJSON.roleCorrelationWithSkill[i]-0.5), statsJSON.roleCorrelationWithSkill[i], "for Player " + toProperString(i+1) + ": ") + "</td>";
        }
        document.getElementById('correlation_tr').innerHTML += correlationHTML;
      }
      delete statsJSON.roleCorrelationWithSkill;
      if ("averageMoves" in statsJSON && statsJSON.averageMoves) {
        statsJSON.averageMoves = statsJSON.averageMoves;
        document.getElementById('gameStatsDiv').innerHTML = "On average this game takes " + cleanFloat(statsJSON.averageMoves[0]) + " moves, based on " + statsJSON.averageMoves[1] + " matches.<br>";        
      }
      delete statsJSON.averageMoves;
      delete statsJSON.rolePlayerAverageScore; // TODO: Actually render this one.
      document.getElementById('gameStatsDiv').innerHTML += renderJSON(statsJSON);

      var theGame = ResourceLoader.load_json(gameName);
      
      if ("gameName" in theGame) {
        document.getElementById('game_gameName').innerHTML = theGame.gameName;
      } else {
        document.getElementById('game_gameName').innerHTML = gameRawName;
      }
      document.getElementById('game_gameVersion').innerHTML = "<b>Version " + theGame.version + "</b>";
      document.getElementById('game_gameNumRoles').innerHTML = "<b>" + toProperString(theGame.numRoles) + " players</b>";
      if ("description" in theGame) {
        document.getElementById('game_gameDescription').innerHTML = "<b>Game description:</b> " + ResourceLoader.load_raw(gameName + theGame.description);
      } else {
        document.getElementById('game_gameDescription').innerHTML = "<b>Game description:</b> <i>Not yet available.</i>";
      }

      var gameMatchesHTML = '';
      var ongoingMatches = ResourceLoader.load_json('//database.ggp.org/query/filterActiveSet,recent,'+getHostHashedPK()).queryMatches;
      var recentMatches = ResourceLoader.load_json('//database.ggp.org/query/filterGame,recent,'+getHostHashedPK()+',' + gameName).queryMatches;      
      if (recentMatches.length == 0) {
        gameMatchesHTML += '<b>This game has not been used in any matches recently.</b>';
      } else {
        var matchListCaption = 'What are the ' + recentMatches.length + ' matches this game has been used in recently?';
        gameMatchesHTML += renderMatchEntries(recentMatches, ongoingMatches, matchListCaption, null);
      }
      document.getElementById('gameMatchesDiv').innerHTML = gameMatchesHTML;
    </script>
  </body>  
</html>